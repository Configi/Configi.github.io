<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>Configi</h1>




<h2>Functions</h2>
<ul class="nowrap">
    <li><a href="#write">write(fd, buf)</a></li>
    <li><a href="#ret_path">ret_path(path)</a></li>
    <li><a href="#bin_path">bin_path(bin)</a></li>
    <li><a href="#exec">exec(args)</a></li>
    <li><a href="#qexec">qexec(args)</a></li>
    <li><a href="#readin">readin(sz)</a></li>
    <li><a href="#fdwrite">fdwrite(path, str)</a></li>
    <li><a href="#awrite">awrite(path, str, mode)</a></li>
    <li><a href="#is_dir">is_dir(path)</a></li>
    <li><a href="#is_file">is_file(path)</a></li>
    <li><a href="#is_link">is_link(path)</a></li>
    <li><a href="#log">log(file, ident, msg, option, facility, level)</a></li>
    <li><a href="#diff_time">diff_time(finish, start)</a></li>
    <li><a href="#effective_username">effective_username()</a></li>
    <li><a href="#real_username">real_username()</a></li>
    <li><a href="#cmd">cmd()</a></li>
    <li><a href="#basename">basename(file)</a></li>
    <li><a href="#dirname">dirname(file)</a></li>
    <li><a href="#decomp_path">decomp_path(str)</a></li>
    <li><a href="#retry_f">retry_f(on_fail, delay, retries)</a></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><strong>lib</strong></li>
</ul>

</div>

<div id="content">

<h1>Module <code>lib</code></h1>
<p>Configi standard library.</p>
<p>

<p> Lua extensions and some unix utilities.
 Depends on cimicida and Luaposix.</p>

<pre>
VENDOR= lib cimicida
VENDOR_C= posix
</pre>

</p>



    <h2 class="section-header "><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "write"></a>
    <strong>write(fd, buf)</strong>
    </dt>
    <dd>
    Write to a file descriptor.
  Wrapper to luaposix unistd.write.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">fd</span>
            <span class="types"><span class="type">int</span></span>
         file descriptor
        </li>
        <li><span class="parameter">buf</span>
            <span class="types"><span class="type">string</span></span>
         string to write
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        true if successfully written.
    </ol>




</dd>
    <dt>
    <a name = "ret_path"></a>
    <strong>ret_path(path)</strong>
    </dt>
    <dd>
    Checks the existence of a given path.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><span class="type">string</span></span>
         the path to check for
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">string</span></span>
        the path if path exists.
    </ol>




</dd>
    <dt>
    <a name = "bin_path"></a>
    <strong>bin_path(bin)</strong>
    </dt>
    <dd>
    Deduce the complete path name of an executable.
  Only checks standard locations.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">bin</span>
            <span class="types"><span class="type">string</span></span>
         executable name
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">string</span></span>
        full path name
    </ol>




</dd>
    <dt>
    <a name = "exec"></a>
    <strong>exec(args)</strong>
    </dt>
    <dd>
    Execute a file.
 The sequence part of args are the arguments passed to the executable <br/>
 The dictionary part of args has options and override. See the following.<br/>

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">args</span>


        <ul>
        <li><span class="parameter">_bin</span>
         override path to binary
        </li>
        <li><span class="parameter">_env</span>
         environment variables
        </li>
        <li><span class="parameter">_cwd</span>
         current working directory
        </li>
        <li><span class="parameter">_stdin</span>
         string as standard input
        </li>
        <li><span class="parameter">_stdout</span>
         path to file as standard output
        </li>
        <li><span class="parameter">_stderr</span>
         path to file as standard error
        </li>
        <li><span class="parameter">_return_code</span>
         return the exit code instead of boolean true
        </li>
        <li><span class="parameter">_ignore_error</span>
         always return boolean true
        </li>
        </li></ul>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><span class="type">bool</span></span>
        true if no errors, nil otherwise</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        result</li>
        <li>
        result.stdout (table) sequence of stdout lines</li>
        <li>
        result.stderr (table) sequence of stderr lines</li>
        <li>
        result.pid (int) pid of terminated executable, if successful; nil otherwise</li>
        <li>
        result.status (string) status: "exited", "killed" or "stopped"; otherwise, an error message</li>
        <li>
        result.code (int) exit status, or signal number responsible for "killed" or "stopped"; otherwise, an errnum</li>
        <li>
        result.bin (string) executable path</li>
    </ol>




</dd>
    <dt>
    <a name = "qexec"></a>
    <strong>qexec(args)</strong>
    </dt>
    <dd>
    Execute a file.
  Use if caller does not care for STDIN, STDOUT or STDERR. <br/>
 The sequence part of args are the arguments passed to the executable <br/>
 The dictionary part of args has options and override. See the following.<br/>

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">args</span>


        <ul>
        <li><span class="parameter">_bin</span>
         override path to binary
        </li>
        <li><span class="parameter">_env</span>
         environment variables
        </li>
        <li><span class="parameter">_cwd</span>
         current working directory
        </li>
        <li><span class="parameter">_stdin</span>
         string as standard input
        </li>
        <li><span class="parameter">_stdout</span>
         path to file as standard output
        </li>
        <li><span class="parameter">_stderr</span>
         path to file as standard error
        </li>
        <li><span class="parameter">_return_code</span>
         return the exit code instead of boolean true
        </li>
        <li><span class="parameter">_ignore_error</span>
         always return boolean true
        </li>
        </li></ul>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><span class="type">bool</span></span>
        true if no errors, nil otherwise</li>
        <li>
           <span class="types"><span class="type">table</span></span>
        result</li>
        <li>
        result.stdout (table) sequence of stdout lines</li>
        <li>
        result.stderr (table) sequence of stderr lines</li>
        <li>
        result.pid (int) pid of terminated executable, if successful; nil otherwise</li>
        <li>
        result.status (string) status: "exited", "killed" or "stopped"; otherwise, an error message</li>
        <li>
        result.code (int) exit status, or signal number responsible for "killed" or "stopped"; otherwise, an errnum</li>
        <li>
        result.bin (string) executable path</li>
    </ol>




</dd>
    <dt>
    <a name = "readin"></a>
    <strong>readin(sz)</strong>
    </dt>
    <dd>
    Read string from a polled STDIN.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">sz</span>
            <span class="types"><span class="type">int</span></span>
         bytes to read
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">string</span></span>
        string read
    </ol>




</dd>
    <dt>
    <a name = "fdwrite"></a>
    <strong>fdwrite(path, str)</strong>
    </dt>
    <dd>
    Write to given path name.
  Wraps lib.write().

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><span class="type">string</span></span>
         name
        </li>
        <li><span class="parameter">str</span>
            <span class="types"><span class="type">string</span></span>
         string to write
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        true if successfully written; otherwise it returns nil
    </ol>




</dd>
    <dt>
    <a name = "awrite"></a>
    <strong>awrite(path, str, mode)</strong>
    </dt>
    <dd>
    Write to give path name atomically.
 Wraps lib.write().

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><span class="type">string</span></span>
         name
        </li>
        <li><span class="parameter">str</span>
            <span class="types"><span class="type">string</span></span>
         string to write
        </li>
        <li><span class="parameter">mode</span>
            <span class="types"><span class="type">number</span></span>
         octal mode when opening file
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><span class="type">bool</span></span>
        true when successfully writing; otherwise, return nil</li>
        <li>
           <span class="types"><span class="type">string</span></span>
        successful message string; otherwise, return a string describing the error</li>
    </ol>




</dd>
    <dt>
    <a name = "is_dir"></a>
    <strong>is_dir(path)</strong>
    </dt>
    <dd>
    Check if a given path name is a directory.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><span class="type">string</span></span>
         name
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        true if a directory; otherwise, return nil
    </ol>




</dd>
    <dt>
    <a name = "is_file"></a>
    <strong>is_file(path)</strong>
    </dt>
    <dd>
    Check if a given path name is a file.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><span class="type">string</span></span>
         name
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        true if a file; otherwise, return nil
    </ol>




</dd>
    <dt>
    <a name = "is_link"></a>
    <strong>is_link(path)</strong>
    </dt>
    <dd>
    Check if a given path name is a symbolic link.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><span class="type">string</span></span>
         name
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        true if a symbolic link; otherwise, return nil
    </ol>




</dd>
    <dt>
    <a name = "log"></a>
    <strong>log(file, ident, msg, option, facility, level)</strong>
    </dt>
    <dd>
    Write to the syslog and a file if given.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">file</span>
            <span class="types"><span class="type">string</span></span>
         path name to log to.
        </li>
        <li><span class="parameter">ident</span>
            <span class="types"><span class="type">string</span></span>
         arbitrary identification string
        </li>
        <li><span class="parameter">msg</span>
            <span class="types"><span class="type">string</span></span>
         message body
        </li>
        <li><span class="parameter">option</span>
            <span class="types"><span class="type">int</span></span>
         see luaposix syslog constants
        </li>
        <li><span class="parameter">facility</span>
            <span class="types"><span class="type">int</span></span>
         see luaposix syslog constants
        </li>
        <li><span class="parameter">level</span>
            <span class="types"><span class="type">int</span></span>
         see luaposix syslog constants
        </li>
    </ul>





</dd>
    <dt>
    <a name = "diff_time"></a>
    <strong>diff_time(finish, start)</strong>
    </dt>
    <dd>
    Calculate difference in time.
 From luaposix.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">finish</span>
            <span class="types"><span class="type">int</span></span>
         end time
        </li>
        <li><span class="parameter">start</span>
            <span class="types"><span class="type">int</span></span>
         start time
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">{sec,</span></span>
        usec} a table of results
    </ol>




</dd>
    <dt>
    <a name = "effective_username"></a>
    <strong>effective_username()</strong>
    </dt>
    <dd>
    Get effective username.

    </ul>
    </ul>


    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">string</span></span>
        username
    </ol>




</dd>
    <dt>
    <a name = "real_username"></a>
    <strong>real_username()</strong>
    </dt>
    <dd>
    Get real username.

    </ul>
    </ul>


    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">string</span></span>
        username
    </ol>




</dd>
    <dt>
    <a name = "cmd"></a>
    <strong>cmd()</strong>
    </dt>
    <dd>
    Execute command or executable as the key for this function-table.
 Wraps lib.exec and lib.qexec so you can execute a given executable as the index to <a href="index.html#cmd">cmd</a>.
 See lib.exec() and lib.qexec() for the possible options and results.<br/><br/>
 The invocation <code>cmd.ls</code> should also work since lib.bin_path() is called on the command.
 Prepend '-' to the command to ignore the output ala lib.qexec(). <br/>

    </ul>
    </ul>





    <h3>Usage:</h3>
    <ul>
        <li><pre class="example">cmd[<span class="string">"/bin/ls"</span>]{ <span class="string">"/tmp"</span> }</pre></li>
        <li><pre class="example">cmd.ls{<span class="string">"/tmp"</span>}</pre></li>
        <li><pre class="example">cmd[<span class="string">"-/bin/ls"</span>]{ <span class="string">"/tmp"</span> }</pre></li>
    </ul>

</dd>
    <dt>
    <a name = "basename"></a>
    <strong>basename(file)</strong>
    </dt>
    <dd>
    File part of a path.
 Same as posix.libgen.basename. Copied here for convenience.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">file</span>
            <span class="types"><span class="type">string</span></span>
         to act on
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">string</span></span>
        filename part of path
    </ol>




</dd>
    <dt>
    <a name = "dirname"></a>
    <strong>dirname(file)</strong>
    </dt>
    <dd>
    Directory name of path.
 Same as posix.libgen.dirname. Copied here for convenience.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">file</span>
            <span class="types"><span class="type">string</span></span>
         to act on
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">string</span></span>
        directory parth of path
    </ol>




</dd>
    <dt>
    <a name = "decomp_path"></a>
    <strong>decomp_path(str)</strong>
    </dt>
    <dd>
    Split a file name.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><span class="type">string</span></span>
         path name
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><span class="type">string</span></span>
        path Directory component</li>
        <li>
           <span class="types"><span class="type">string</span></span>
        base Basename minus the extension</li>
        <li>
           <span class="types"><span class="type">string</span></span>
        ext The extension</li>
    </ol>




</dd>
    <dt>
    <a name = "retry_f"></a>
    <strong>retry_f(on_fail, delay, retries)</strong>
    </dt>
    <dd>
    Retry factory.

    </ul>
    </ul>

    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">on_fail</span>
            <span class="types"><span class="type">function</span></span>
         function to run in case of failure. Takes in the second return value from the retried function as an argument.
        </li>
        <li><span class="parameter">delay</span>
            <span class="types"><span class="type">number</span></span>
         seconds to sleep after a failure. Default is 30 seconds.
        </li>
        <li><span class="parameter">retries</span>
            <span class="types"><span class="type">number</span></span>
         number of tries. Default is to retry indefinitely.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">function</span></span>
        a function that runs ...
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">run = retry_f(<span class="keyword">function</span>() <span class="keyword">end</span>, <span class="number">3</span>, <span class="number">1</span>)
run(<span class="global">string</span>.match, <span class="string">"match"</span>, <span class="string">"match"</span>)</pre>
    </ul>

</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2017-05-09 15:50:37 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
